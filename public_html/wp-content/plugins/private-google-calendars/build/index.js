(()=>{"use strict";const e=window.wp.element,t=window.wp.blocks,n=window.wp.blockEditor,a=window.wp.components,s=JSON.stringify(window.pgc_trans.fullcalendar_version>=5?{headerToolbar:{start:"prev,next today",center:"title",end:"dayGridMonth,timeGridWeek,listWeek"}}:{header:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,listWeek"}},null,2);function i(e,t,n,a){const s=Object.assign({},e);s[n]=a;const i={};return i[t]=s,i}function c(e){try{return""===e||Object.keys(JSON.parse(e)).length>0}catch(e){return!1}}(0,t.registerBlockType)("pgc-plugin/calendar",{title:"Private Google Calendars",icon:"calendar",category:"widgets",attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{filter:"top",theme:"",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},edit(t){const[l,r]=(0,e.useState)(c(t.attributes.fullcalendarconfig)),[d,o]=(0,e.useState)(t.attributes.fullcalendarconfig),[u,p]=(0,e.useState)(!1),h=t.attributes.calendars;let f=0;Object.keys(h).forEach((function(e){h[e]&&(f+=1)}));const b=t.attributes.config,g=t.attributes.hideoptions,w=t.attributes.fullcalendarconfig,y=t.attributes.publiccalendarids,m=t.attributes.uncheckedcalendarids,_=function(e){t.setAttributes(i(h,"calendars",this,e))},v=function(e){t.setAttributes(i(b,"config",this,e))},k=function(e){t.setAttributes(i(g,"hideoptions",this,e))},E=function(e){r(c(e)),t.setAttributes({fullcalendarconfig:""===e?"":e})};let j=null;j=Object.keys(window.pgc_selected_calendars).map((t=>{const n=window.pgc_selected_calendars[t];return(0,e.createElement)(a.CheckboxControl,{style:{backgroundColor:n.backgroundColor},className:"pgc-sidebar-row",onChange:_.bind(t),label:n.summary,checked:t in h&&h[t]})})),j.length||j.push((0,e.createElement)("em",null,"No private calendars")),j.push((0,e.createElement)(a.HorizontalRule,null));const C=[["eventpopup",window.pgc_trans.eventpopup],["eventlink",window.pgc_trans.eventlink],["eventdescription",window.pgc_trans.eventdescription],["eventlocation",window.pgc_trans.eventlocation],["eventattendees",window.pgc_trans.eventattendees],["eventattachments",window.pgc_trans.eventattachments],["eventcreator",window.pgc_trans.eventcreator],["eventcalendarname",window.pgc_trans.eventcalendarname]].map((t=>(0,e.createElement)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:v.bind(t[0]),label:t[1],checked:b[t[0]]}))),O=g.hidepassed?(0,e.createElement)(a.TextControl,{label:`${window.pgc_trans.more_than} ${g.hidepasseddays} ${window.pgc_trans.days_ago}`,type:"number",min:0,value:g.hidepasseddays,onChange:k.bind("hidepasseddays")}):null,$=g.hidefuture?(0,e.createElement)(a.TextControl,{label:`${window.pgc_trans.more_than} ${g.hidefuturedays} ${window.pgc_trans.days_from_now}`,type:"number",min:0,value:g.hidefuturedays,onChange:k.bind("hidefuturedays")}):null;(0,e.useEffect)((()=>{const e=wp.data.subscribe((function(){if(wp.data.select("core/editor")){const t=wp.data.select("core/editor").isSavingPost(),n=wp.data.select("core/editor").isAutosavingPost();if(t&&!n){if(!l){let t=setTimeout((function(){clearTimeout(t),wp.data.dispatch("core/notices").createWarningNotice(window.pgc_trans.malformed_json)}),0);e()}if(!f&&!y){let t=setTimeout((function(){clearTimeout(t),wp.data.dispatch("core/notices").createWarningNotice(window.pgc_trans.enter_one_or_more_public_calendar_ids)}),0);e()}}}}));return e}));const N=d?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.TextareaControl,{rows:10,onKeyDown:function(e){if(9==e.keyCode){e.preventDefault();const t=e.target,n=t.selectionStart,a=t.value.substring(0,n)+"  "+t.value.substring(t.selectionEnd);E(a);let s=setTimeout((()=>{clearTimeout(s),t.selectionEnd=n+2}),0)}},className:"pgc-fullcalendarconfigarea "+(l?"":"has-error"),value:w,help:l?"":window.pgc_trans.malformed_json_short,label:window.pgc_trans.fullcalendar_config,placeHolder:s,onChange:E}),(0,e.createElement)("div",{className:"pgc-copy-link"},(0,e.createElement)("a",{href:"#",onClick:e=>{e.preventDefault(),E(s)}},window.pgc_trans.copy_default_fullcalendar_config),(0,e.createElement)("span",{onClick:()=>p(!0),class:"dashicons dashicons-editor-help"}))):null,S=u?function(t){return(0,e.createElement)(a.Modal,{title:"FullCalendar config",onRequestClose:t.onClose},(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:window.pgc_trans.copy_fullcalendar_config_info}}),(0,e.createElement)("p",{dangerouslySetInnerHTML:{__html:window.pgc_trans.fullcalendar_docs_link}}))}({onClose:()=>{p(!1)}}):null;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(a.PanelBody,{title:window.pgc_trans.selected_calendars+" ("+(0===f?window.pgc_trans.none:f)+")",initialOpen:!0},j,(0,e.createElement)(a.TextControl,{label:window.pgc_trans.comma_separated_list_calendar_ids,value:y,onChange:function(e){t.setAttributes({publiccalendarids:e})}})),(0,e.createElement)(a.PanelBody,{title:window.pgc_trans.calendar_options,initialOpen:!0},(0,e.createElement)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:o,label:window.pgc_trans.edit_fullcalendar_config,checked:d}),(0,e.createElement)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:k.bind("hidepassed"),label:window.pgc_trans.hide_passed_events,checked:g.hidepassed}),O,(0,e.createElement)(a.CheckboxControl,{className:"pgc-sidebar-row",onChange:k.bind("hidefuture"),label:window.pgc_trans.hide_future_events,checked:g.hidefuture}),$),(0,e.createElement)(a.PanelBody,{title:window.pgc_trans.theme,initialOpen:!0},(0,e.createElement)(a.SelectControl,{value:b.theme||"",onChange:v.bind("theme"),options:[{value:"",label:window.pgc_trans.default},...window.pgc_trans.themes.map((function(e){return{value:e,label:e}}))]})),(0,e.createElement)(a.PanelBody,{title:window.pgc_trans.filter_options},(0,e.createElement)(a.SelectControl,{value:!0===b.filter?"top":b.filter,onChange:v.bind("filter"),options:[{value:"",label:window.pgc_trans.hide_filter},{value:"top",label:window.pgc_trans.show_filter_top},{value:"bottom",label:window.pgc_trans.show_filter_bottom}]}),(0,e.createElement)(a.TextControl,{label:window.pgc_trans.filter_uncheckedcalendarids,value:m,onChange:function(e){t.setAttributes({uncheckedcalendarids:e})}})),(0,e.createElement)(a.PanelBody,{title:window.pgc_trans.popup_options+" ("+(b.eventpopup?window.pgc_trans.show:window.pgc_trans.hide)+")",initialOpen:!0},C)),(0,e.createElement)("div",null,"Private Google Calendars Block"),N,S)},save(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){"filter"===e||"theme"===e?a.push(e+'="'+s[e]+'"'):a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),(t.attributes.publiccalendarids||Object.keys(t.attributes.calendars).length)&&(n.calendarids=t.attributes.publiccalendarids,Object.keys(t.attributes.calendars).length)){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),n.calendarids+=(n.calendarids.length&&e.length?",":"")+e.join(",")}return t.attributes.uncheckedcalendarids&&(n.uncheckedcalendarids=t.attributes.uncheckedcalendarids),Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")},deprecated:[{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{filter:"top",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){"filter"===e?a.push(e+'="'+s[e]+'"'):a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),(t.attributes.publiccalendarids||Object.keys(t.attributes.calendars).length)&&(n.calendarids=t.attributes.publiccalendarids,Object.keys(t.attributes.calendars).length)){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),n.calendarids+=(n.calendarids.length&&e.length?",":"")+e.join(",")}return t.attributes.uncheckedcalendarids&&(n.uncheckedcalendarids=t.attributes.uncheckedcalendarids),Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")}},{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{public:!1,filter:"top",eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},uncheckedcalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){"filter"===e?a.push(e+'="'+s[e]+'"'):a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),t.attributes.config.public)n.calendarids=t.attributes.publiccalendarids;else if(Object.keys(t.attributes.calendars).length){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),e.length&&(n.calendarids=e.join(","))}return t.attributes.uncheckedcalendarids&&(n.uncheckedcalendarids=t.attributes.uncheckedcalendarids),Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")}},{attributes:{calendars:{type:"object",default:{}},config:{type:"object",default:{public:!1,filter:!0,eventpopup:!1,eventlink:!1,eventdescription:!1,eventlocation:!1,eventattendees:!1,eventattachments:!1,eventcreator:!1,eventcalendarname:!1}},fullcalendarconfig:{type:"string",default:""},publiccalendarids:{type:"string",default:""},hideoptions:{type:"object",default:{hidefuture:!1,hidefuturedays:0,hidepassed:!1,hidepasseddays:0}}},save:function(t){const n={},a=[],s=t.attributes.config,i=t.attributes.hideoptions,c=t.attributes.fullcalendarconfig;let l=!1;try{l=c&&Object.keys(JSON.parse(c)).length>0}catch(e){}if(l&&a.push(`fullcalendarconfig='${c}'`),Object.keys(s).forEach((function(e){a.push(e+'="'+(s[e]?"true":"false")+'"')})),a.push(`hidepassed="${i.hidepassed?i.hidepasseddays:"false"}"`),a.push(`hidefuture="${i.hidefuture?i.hidefuturedays:"false"}"`),t.attributes.config.public)n.calendarids=t.attributes.publiccalendarids;else if(Object.keys(t.attributes.calendars).length){const e=[];Object.keys(t.attributes.calendars).forEach((function(n){n in t.attributes.calendars&&t.attributes.calendars[n]&&e.push(n)})),e.length&&(n.calendarids=e.join(","))}return Object.keys(n).forEach((function(e){a.push(e+'="'+n[e]+'"')})),(0,e.createElement)("p",null,"[pgc ",a.join(" "),"]")}}]})})();